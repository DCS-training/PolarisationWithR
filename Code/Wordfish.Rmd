---
title: "Polarization Analysis using Wordfish in R"
author: "Wordfish"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Install & Load Required Packages

```{r}
#install.packages("usethis")
library(usethis)
library(devtools)
#devtools::install_github("quanteda/quanteda.textmodels", dependencies = TRUE)
library(dplyr)
library(readr)
library(stringr)
library(quanteda.textmodels)
library(quanteda)
library(ggplot2)
```

## 2. Load Dataset

```{r}

data <- read_csv("EU-China_resolutions.csv")  # Read CSV file
head(data)  # View first few rows of the dataset
glimpse(data)

```

## 3. Tokenize Text and Create a Document-Feature Matrix (DFM)

```{r}
tokens_all <- tokens(data$full_text, remove_punct = TRUE)
dfm_all <- dfm(tokens_all)
dfm_all <- dfm_remove(dfm_all, pattern = stopwords("en"))  # Remove stopwords

dfm_all <- dfm_trim(dfm_all, min_termfreq = 2, min_docfreq = 2)  # Remove rare words
```

## 4. Fit Wordfish Model

```{r}
wordfish_model <- textmodel_wordfish(dfm_all)

print(wordfish_model$converged)
print(wordfish_model)

summary(wordfish_model$theta)  # Check if scores exist

data$wordfish_score <- wordfish_model$theta
head(data$wordfish_score)  # Check if the column exists
```

## 5. Extract Document Positions

```{r}
wordfish_scores <- predict(wordfish_model)
data$wordfish_score <- wordfish_scores  # Store scores in dataset
```

## 6. Save Updated Dataset

```{r}
write_csv(data, "EU-China_with_wordfish_scores.csv")
```

## 7. Visualize the Polarization Distribution

```{r}
ggplot(data, aes(x = wordfish_score)) +
  geom_histogram(binwidth = 0.5, fill = "green", alpha = 0.6) +  # Plot histogram
  theme_minimal() +  # Apply minimal theme
  labs(title = "Polarization of UNN debate(Wordfish)", x = "Wordfish Score", y = "Count")
```

## 8. Find the Document with the Lowest Wordfish Score

```{r}
min_index<- which.min(data$wordfish_score) 
min_doc <- data[min_index, "full_text"] # Extract the document print(min_doc) \# Display its content

min_index
min_doc
```
